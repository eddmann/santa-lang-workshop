ARG BUILDER_IMAGE=local/santa-python-claudecode-sonnet4-1757409766:build

FROM ${BUILDER_IMAGE} AS builder

# Copy source code
COPY --chown=dev:dev . /work

# Runtime stage
FROM python:3.13-slim

# Create a non-root user
RUN useradd -m -u 1000 dev

# Set up the working directory
WORKDIR /work

# Copy the application from builder
COPY --from=builder --chown=dev:dev /work /work

# Switch to non-root user
USER dev

# Set Python unbuffered to ensure output appears in real time
ENV PYTHONUNBUFFERED=1

# Set the entrypoint to our CLI
ENTRYPOINT ["python3", "/work/cli"]